---
phase: 02-swipe-ui
plan: 02
type: execute
---

<objective>
Wire swipe gestures to API actions and complete the swipe loop.

Purpose: Make the cards interactive - swipe left to ignore, swipe right to save, with API persistence.
Output: Fully functional swipe loop that saves user decisions to the backend.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-swipe-ui/02-01-SUMMARY.md (will exist after 02-01)

# Key files:
@v2/js/swipe.js
@v2/js/api.js
@v2/js/opportunities.js (created in 02-01)

**Tech stack available:**
- SwipeManager.registerCard(card, { onDecision: (direction, card) => {} })
- SwipeManager.forceDecision(card, direction) for button taps
- api.updateOpportunityStatus(id, status)
- swipe:complete event fires after fly-off animation

**Established patterns:**
- pp:auth-changed for auth state updates
- Console logging for action feedback
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire swipe gestures to API actions</name>
  <files>v2/js/opportunities.js</files>
  <action>
Extend opportunities.js to handle swipe decisions:

1. After creating each card in createCardElement():
   - Call SwipeManager.registerCard(card, { onDecision })
   - In onDecision callback:
     - direction === 'right' → status = 'todo' (save)
     - direction === 'left' → status = 'ignored'
     - Call handleSwipeDecision(opportunity, status)

2. Add `handleSwipeDecision(opportunity, status)` async function:
   - If not authenticated: show console warning, don't call API
   - Try: await api.updateOpportunityStatus(opportunity.id, status)
   - On success:
     - Remove opportunity from local array
     - Push to actionHistory for undo
     - Log action: "Saved: [title]" or "Ignored: [title]"
   - On error: console.error, show error state

3. Listen for swipe:complete event on card:
   - After fly-off animation completes
   - Increment currentIndex or re-render stack
   - Unregister card from SwipeManager

4. Add action buttons below card (optional enhancement):
   - X button (force left swipe)
   - ✓ button (force right swipe)
   - Use SwipeManager.forceDecision(card, direction)

5. Handle auth requirement:
   - If not authenticated, disable swipe registration
   - Show "Log in to save jobs" prompt on card
   - Re-check on pp:auth-changed
  </action>
  <verify>
1. Open http://localhost:8080/v2/ in browser
2. Swipe card right → console shows "Saved: [title]", Network shows PUT to API
3. Swipe card left → console shows "Ignored: [title]", Network shows PUT to API
4. Card flies off and next card becomes active
5. After all cards: empty state shows
  </verify>
  <done>
- Swipe right saves opportunity (todo status)
- Swipe left ignores opportunity (ignored status)
- API calls succeed (check Network tab)
- Next card becomes active after swipe
- Empty state shows when deck exhausted
  </done>
</task>

<task type="auto">
  <name>Task 2: Add undo functionality and haptic feedback</name>
  <files>v2/js/opportunities.js, v2/css/styles.css</files>
  <action>
Add polish to the swipe experience:

1. Undo functionality:
   - Add `undoLastAction()` function
   - Pop from actionHistory
   - Restore opportunity to array at original position
   - Call api.updateOpportunityStatus(id, 'todo') to reset
   - Re-render cards

2. Add undo button:
   - Show after each swipe action (toast-style)
   - Auto-dismiss after 5 seconds
   - CSS: `.undo-toast` positioned at bottom of screen

3. Haptic feedback:
   - Add triggerHaptic() helper (navigator.vibrate if available)
   - Call on swipe decision

4. Keyboard shortcuts (for desktop testing):
   - ArrowLeft → force swipe left
   - ArrowRight → force swipe right
   - Cmd/Ctrl+Z → undo

5. CSS additions:
   - `.action-buttons` container for X/✓ buttons
   - `.action-button` styling (large touch targets, 48px min)
   - `.undo-toast` styling
  </action>
  <verify>
1. Swipe a card, see undo toast appear
2. Click undo → card returns to deck
3. Press arrow keys → cards swipe
4. Press Cmd+Z → undo works
5. On mobile: feel haptic vibration on swipe
  </verify>
  <done>
- Undo button appears after swipe
- Undo restores card to deck
- Keyboard shortcuts work
- Haptic feedback fires (on supported devices)
- Touch targets are minimum 48px
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete swipe UI with card stack, swipe gestures, API integration, and undo</what-built>
  <how-to-verify>
    1. Run: python3 -m http.server 8080
    2. Open: http://localhost:8080/v2/
    3. Test swipe right → card saves, flies off right, next card appears
    4. Test swipe left → card ignored, flies off left, next card appears
    5. Test undo button → card returns
    6. Swipe through all cards → empty state shows
    7. Check Network tab → API calls succeeding
    8. Test on mobile (or Chrome DevTools mobile mode) → touch swipes work
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Swipe right saves opportunity to API
- [ ] Swipe left ignores opportunity via API
- [ ] Cards animate off screen correctly
- [ ] Next card becomes active after swipe
- [ ] Empty state shows when no more cards
- [ ] Undo functionality works
- [ ] No console errors during swipe flow
</verification>

<success_criteria>

- Complete swipe loop: load → swipe → save/ignore → next → empty
- API integration working (statuses persist)
- Undo available after each action
- Keyboard and touch input both work
- Human verification passed
- Phase 2 complete, ready for Phase 3 (Applications Tracker)
</success_criteria>

<output>
After completion, create `.planning/phases/02-swipe-ui/02-02-SUMMARY.md`
</output>
