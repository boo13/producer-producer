---
phase: 06-visual-polish
plan: 02
type: execute
domain: frontend-design
---

<objective>
Add animated robot mascot with speech bubble reactions to give the app personality - "Duolingo for jobs" character that encourages and entertains during job swiping.

Purpose: Create emotional connection through a mascot that reacts to user actions with witty, relevant messages
Output: Animated pixel robot, speech bubble component, contextual reaction system for swipes
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-visual-polish/06-01-SUMMARY.md (will exist after Plan 1)

**v1 reference implementations:**
@js/space-invader.js - Pixel art robot drawn on canvas, 2-frame animation
@js/speech-bubble.js - Speech bubble controller with idle cycling and reactions
@js/speech-config.js - Message configuration for different contexts

**Design direction:**
- Robot mascot positioned near bottom of screen (above action buttons)
- Speech bubble appears above robot with witty messages
- Contextual reactions to swipes:
  - Save (swipe right): Encouraging ("Nice find!", "Good taste!", "That's a keeper!")
  - Ignore (swipe left): Sympathetic ("On to the next one", "Not the one", "Keep searching!")
  - Undo: Playful ("Changed your mind?", "Second thoughts?", "Plot twist!")
  - Empty state: Motivating ("All caught up!", "Check back soon", "You're on fire!")
- Idle messages cycle when user isn't actively swiping (sarcastic job hunting humor from v1)

**Current v2 files:**
@v2/index.html
@v2/css/styles.css
@v2/js/opportunities.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add robot mascot and speech bubble HTML/CSS</name>
  <files>v2/index.html, v2/css/styles.css</files>
  <action>
1. In index.html, add robot and speech bubble elements before closing #app div:

```html
<!-- Robot Mascot -->
<div class="mascot" id="mascot">
  <div class="speech-bubble" id="speech-bubble">
    <span class="speech-bubble__text">Looking for your next gig...</span>
  </div>
  <canvas class="mascot__robot" id="robot-canvas" width="64" height="64"></canvas>
</div>
```

2. In CSS, add mascot positioning:

.mascot {
  position: fixed;
  bottom: 160px; /* Above action buttons (140px) + some padding */
  left: 20px;
  z-index: 50;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 8px;
  pointer-events: none;
}

.mascot__robot {
  width: 48px;
  height: 48px;
  image-rendering: pixelated;
  pointer-events: auto;
  cursor: pointer;
}

3. Style speech bubble to match v1 but fit new palette:

.speech-bubble {
  background: var(--card-bg, #f5f0e1);
  border: 2px solid var(--card-border, #d4cfc3);
  border-radius: 12px;
  padding: 10px 14px;
  max-width: 200px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  position: relative;
  transform: translateY(0);
  transition: transform 200ms ease, opacity 200ms ease;
}

/* Speech bubble tail pointing down-left toward robot */
.speech-bubble::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 16px;
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-top: 10px solid var(--card-border, #d4cfc3);
}

.speech-bubble::before {
  content: '';
  position: absolute;
  bottom: -7px;
  left: 18px;
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 8px solid var(--card-bg, #f5f0e1);
  z-index: 1;
}

.speech-bubble__text {
  font-family: 'VT323', monospace;
  font-size: 1rem;
  color: var(--ink, #2a2a2e);
  line-height: 1.3;
}

/* Animation states */
.speech-bubble--changing {
  opacity: 0.5;
  transform: translateY(-4px);
}

.speech-bubble--reacting {
  animation: bubble-bounce 300ms ease;
}

@keyframes bubble-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

/* Hide mascot on applications view */
.mascot[hidden] {
  display: none;
}

4. Ensure mascot stays within mobile max-width container by positioning relative to viewport left, not container.
  </action>
  <verify>Open v2/index.html - should see empty speech bubble and space for robot canvas in bottom-left area above action buttons</verify>
  <done>HTML structure for mascot in place. Speech bubble styled with warm palette, tail pointing to robot. Positioned fixed in bottom-left.</done>
</task>

<task type="auto">
  <name>Task 2: Create robot animation and speech bubble modules</name>
  <files>v2/js/robot.js, v2/js/speech-bubble.js, v2/js/speech-config.js, v2/index.html</files>
  <action>
1. Create v2/js/speech-config.js with swipe-focused messages:

```javascript
const SPEECH_CONFIG = {
  idleInterval: 8000, // Longer interval for less distraction
  reactionCooldown: 4000,

  idle: [
    "Why is every job 'fast-paced'?",
    "'Competitive salary' competing with what?",
    "Entry level. 5+ years required.",
    "'We're like a family here' ðŸš©",
    "Looking for a unicorn who does everything",
    "Salary: DOE. Experience: Also DOE.",
    "Posted 30+ days ago. Still 'actively hiring.'",
    "Must know software released 2 years ago for 5 years",
    "Hybrid = come in whenever we feel like it",
  ],

  reactions: {
    save: [
      "Nice find! ðŸŽ¯",
      "Good taste!",
      "That's a keeper!",
      "Solid choice!",
      "One for the list!",
      "Looking good!",
    ],
    ignore: [
      "On to the next!",
      "Not the one",
      "Keep searching!",
      "Nope, next!",
      "Moving on...",
      "There's better out there",
    ],
    undo: [
      "Changed your mind?",
      "Second thoughts!",
      "Plot twist!",
      "Wait, come back!",
      "Reconsidering?",
    ],
    empty: [
      "All caught up! ðŸŽ‰",
      "You're on fire today!",
      "Check back for more",
      "Clean slate!",
      "Swiping machine!",
    ],
    login: [
      "Welcome back!",
      "Ready to find your gig?",
      "Let's do this!",
    ],
    addJob: [
      "Nice hustle!",
      "Adding to the pile!",
      "Found one in the wild!",
    ],
  }
};

if (typeof window !== 'undefined') {
  window.SPEECH_CONFIG = SPEECH_CONFIG;
}
```

2. Create v2/js/speech-bubble.js (simplified from v1):

```javascript
(function initSpeechBubble() {
  const bubble = document.getElementById('speech-bubble');
  const textEl = bubble?.querySelector('.speech-bubble__text');

  if (!bubble || !textEl || typeof SPEECH_CONFIG === 'undefined') return;

  const config = SPEECH_CONFIG;
  let idleTimer = null;
  let cooldownTimer = null;
  let lastIdleIndex = -1;

  const pickRandom = (arr, avoid = -1) => {
    if (!arr?.length) return null;
    let idx;
    do { idx = Math.floor(Math.random() * arr.length); }
    while (idx === avoid && arr.length > 1);
    return { item: arr[idx], index: idx };
  };

  const setText = (text, isReaction = false) => {
    bubble.classList.add('speech-bubble--changing');
    setTimeout(() => {
      textEl.textContent = text;
      bubble.classList.remove('speech-bubble--changing');
      if (isReaction) {
        bubble.classList.add('speech-bubble--reacting');
        setTimeout(() => bubble.classList.remove('speech-bubble--reacting'), 300);
      }
    }, 150);
  };

  const showIdle = () => {
    const result = pickRandom(config.idle, lastIdleIndex);
    if (result) {
      lastIdleIndex = result.index;
      setText(result.item);
    }
  };

  const startIdle = () => {
    stopIdle();
    showIdle();
    idleTimer = setInterval(showIdle, config.idleInterval);
  };

  const stopIdle = () => {
    if (idleTimer) { clearInterval(idleTimer); idleTimer = null; }
  };

  const react = (category) => {
    const messages = config.reactions[category];
    if (!messages?.length) return;

    if (cooldownTimer) clearTimeout(cooldownTimer);
    stopIdle();

    const { item } = pickRandom(messages);
    setText(item, true);

    cooldownTimer = setTimeout(() => {
      startIdle();
      cooldownTimer = null;
    }, config.reactionCooldown);
  };

  // Pause when tab hidden
  document.addEventListener('visibilitychange', () => {
    document.hidden ? stopIdle() : startIdle();
  });

  window.speechBubble = { react, startIdle, stopIdle };
  startIdle();
})();
```

3. Create v2/js/robot.js (pixel robot animation):

```javascript
(function initRobot() {
  const canvas = document.getElementById('robot-canvas');
  if (!canvas?.getContext) return;

  const ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled = false;

  // Simple friendly robot - 16x16 grid scaled up
  const frames = [
    [
      '....########....',
      '..############..',
      '..##..####..##..',
      '..##..####..##..',
      '..############..',
      '..############..',
      '....########....',
      '..############..',
      '.##############.',
      '.##############.',
      '.##..######..##.',
      '.##..######..##.',
      '....##....##....',
      '....##....##....',
      '...##......##...',
      '...##......##...',
    ],
    [
      '....########....',
      '..############..',
      '..##..####..##..',
      '..##..####..##..',
      '..############..',
      '..############..',
      '....########....',
      '..############..',
      '.##############.',
      '.##############.',
      '.##..######..##.',
      '.##..######..##.',
      '....##....##....',
      '...##......##...',
      '...##......##...',
      '....##....##....',
    ],
  ];

  const cols = 16;
  const rows = 16;
  const pixel = canvas.width / cols;
  const color = '#2a2a2e'; // Dark ink color to match text

  const draw = (frame) => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = color;
    frame.forEach((row, y) => {
      [...row].forEach((char, x) => {
        if (char === '#') {
          ctx.fillRect(x * pixel, y * pixel, pixel, pixel);
        }
      });
    });
  };

  let current = 0;
  draw(frames[current]);

  setInterval(() => {
    current = (current + 1) % frames.length;
    draw(frames[current]);
  }, 800);

  // React to clicks on robot
  canvas.addEventListener('click', () => {
    if (window.speechBubble) {
      window.speechBubble.react('idle'); // Show random idle message
    }
  });
})();
```

4. Add script tags to v2/index.html before closing body (after other scripts):
```html
<script src="js/speech-config.js"></script>
<script src="js/speech-bubble.js"></script>
<script src="js/robot.js"></script>
```
  </action>
  <verify>Reload v2/ - robot should animate (subtle walk), speech bubble should cycle through idle messages every 8 seconds</verify>
  <done>Robot renders as pixel art with 2-frame animation. Speech bubble displays and cycles idle messages. Click on robot triggers new message.</done>
</task>

<task type="auto">
  <name>Task 3: Wire speech reactions to swipe events</name>
  <files>v2/js/opportunities.js</files>
  <action>
Connect the speech bubble to user actions:

1. In opportunities.js, find where swipe actions are handled (handleSwipeComplete or similar)

2. After successful save (swipe right / todo status):
   ```javascript
   if (window.speechBubble) window.speechBubble.react('save');
   ```

3. After ignore (swipe left / ignored status):
   ```javascript
   if (window.speechBubble) window.speechBubble.react('ignore');
   ```

4. After undo action:
   ```javascript
   if (window.speechBubble) window.speechBubble.react('undo');
   ```

5. When reaching empty state (no more cards):
   ```javascript
   if (window.speechBubble) window.speechBubble.react('empty');
   ```

6. In login.js, after successful magic link request:
   ```javascript
   if (window.speechBubble) window.speechBubble.react('login');
   ```

7. In add-job.js, after successful job add:
   ```javascript
   if (window.speechBubble) window.speechBubble.react('addJob');
   ```

8. Hide mascot when on applications view (in view toggle logic):
   ```javascript
   const mascot = document.getElementById('mascot');
   if (mascot) mascot.hidden = (view === 'applications');
   ```

IMPORTANT: All speechBubble calls should be guarded with `if (window.speechBubble)` to avoid errors if module fails to load.
  </action>
  <verify>Swipe cards left and right - speech bubble should show contextual reactions. Undo should trigger undo message. Empty state should show encouraging message.</verify>
  <done>Speech bubble reacts to all user actions: save shows encouragement, ignore shows sympathy, undo is playful, empty state is motivating. Mascot hides on applications view.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Robot mascot with speech bubble reactions - the personality layer for "Duolingo for jobs"</what-built>
  <how-to-verify>
    1. Run: python3 -m http.server 8080
    2. Visit: http://localhost:8080/v2/
    3. Mascot presence:
       - Robot should appear in bottom-left, above action buttons
       - Speech bubble should float above robot with tail pointing down
       - Robot should have subtle 2-frame animation (walking/bobbing)
    4. Idle behavior:
       - Speech bubble should cycle through sarcastic job-hunting messages
       - ~8 second interval between messages
       - Click robot to trigger new message
    5. Reaction testing:
       - Swipe RIGHT (save): Should show encouraging message ("Nice find!", etc.)
       - Swipe LEFT (ignore): Should show sympathetic message ("On to the next!", etc.)
       - Click UNDO: Should show playful message ("Changed your mind?", etc.)
       - Reach empty state: Should show motivating message ("All caught up!", etc.)
    6. View switching:
       - Switch to "Saved" tab: Mascot should hide
       - Switch back to "Swipe" tab: Mascot should reappear
    7. Overall feel:
       - Messages should feel witty and relevant, not annoying
       - Reactions should be satisfying, add to the experience
       - Robot should feel like a helpful companion, not intrusive
  </how-to-verify>
  <resume-signal>Type "approved" if mascot and reactions feel right, or describe adjustments needed (different messages, positioning, timing, etc.)</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Robot mascot renders with animation
- [ ] Speech bubble displays with proper styling (warm palette)
- [ ] Idle messages cycle every ~8 seconds
- [ ] Save reaction triggers on swipe right
- [ ] Ignore reaction triggers on swipe left
- [ ] Undo reaction triggers on undo
- [ ] Empty state reaction triggers when no cards left
- [ ] Mascot hides on applications view
- [ ] User approved the personality/feel
</verification>

<success_criteria>
- Mascot adds personality without being intrusive
- Reactions feel contextually relevant and satisfying
- Messages are witty and on-brand (sarcastic job hunting humor)
- Overall "Duolingo for jobs" feel achieved
- Phase 6 complete - visual polish done
</success_criteria>

<output>
After completion, create `.planning/phases/06-visual-polish/06-02-SUMMARY.md`:

# Phase 06 Plan 02: Robot Mascot & Personality Summary

**[One-liner about what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list with descriptions]

## Decisions Made
- [Design/implementation choices]

## Issues Encountered
- [Problems and resolutions, or "None"]

## Next Step
Phase 6 complete. v2 visual polish done. Ready for deployment/testing.
</output>
